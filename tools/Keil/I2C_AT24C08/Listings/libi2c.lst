C51 COMPILER V9.56.0.0   LIBI2C                                                            08/03/2017 23:08:08 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE LIBI2C
OBJECT MODULE PLACED IN .\Objects\libi2c.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE libi2c.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\li
                    -bi2c.lst) TABS(2) OBJECT(.\Objects\libi2c.obj)

line level    source

   1          #include "libi2c.h"
*** ERROR C100 IN LINE 13 OF libi2c.h: unprintable character 0xEF skipped
*** ERROR C100 IN LINE 13 OF libi2c.h: unprintable character 0xBC skipped
*** ERROR C100 IN LINE 13 OF libi2c.h: unprintable character 0x9B skipped
*** ERROR C132 IN LINE 14 OF libi2c.h: 'I2CStart': not in formal parameter list
*** ERROR C132 IN LINE 15 OF libi2c.h: 'I2cStop': not in formal parameter list
*** ERROR C132 IN LINE 16 OF libi2c.h: '_write_byte': not in formal parameter list
*** ERROR C132 IN LINE 17 OF libi2c.h: '_delay': not in formal parameter list
*** ERROR C132 IN LINE 18 OF libi2c.h: 'read_byte': not in formal parameter list
*** ERROR C132 IN LINE 19 OF libi2c.h: '_write': not in formal parameter list
*** ERROR C132 IN LINE 20 OF libi2c.h: '_read': not in formal parameter list
   2          
   3          bit flag;  //åº”ç­”æ ‡å¿—ä½
*** ERROR C132 IN LINE 3 OF libi2c.c: 'flag': not in formal parameter list
   4          void main()
   5          {
*** ERROR C132 IN LINE 5 OF libi2c.c: 'main': not in formal parameter list
*** ERROR C141 IN LINE 5 OF libi2c.c: syntax error near '{'
   6              init();
*** ERROR C132 IN LINE 6 OF libi2c.c: 'init': not in formal parameter list
   7              write_add(5,0xaa); //å‘åœ°å€5å†™å…¥0xaa
*** ERROR C141 IN LINE 7 OF libi2c.c: syntax error near '5'
*** ERROR C132 IN LINE 7 OF libi2c.c: 'write_add': not in formal parameter list
   8              delay(10);      //å»¶æ—¶,å¦åˆ™è¢«å‘å‘€ï¼ï¼ï¼
*** ERROR C141 IN LINE 8 OF libi2c.c: syntax error near '10'
*** ERROR C132 IN LINE 8 OF libi2c.c: 'delay': not in formal parameter list
   9               P1=read_add(5);      //è¯»å–åœ°å€5çš„å€¼
*** ERROR C244 IN LINE 9 OF libi2c.c: 'P1': can't initialize, bad type or class
  10               while(1);    
  11          }
  12          
  13          
  14          
  15          //***************************************************************************  
  16          void delay()//ç®€å•å»¶æ—¶å‡½æ•°  
  17          { ;; }  
  18          //***************************************************************************  
  19          void start()  //å¼€å§‹ä¿¡å· SCLåœ¨é«˜ç”µå¹³æœŸé—´ï¼ŒSDAä¸€ä¸ªä¸‹é™æ²¿åˆ™è¡¨ç¤ºå¯åŠ¨ä¿¡å·  
  20          {     
  21   1          sda=1; //é‡Šæ”¾SDAæ€»çº¿  
  22   1          delay();  
  23   1          scl=1;  
  24   1          delay();  
  25   1          sda=0;  
  26   1          delay();  
  27   1      }  
  28          //***************************************************************************  
  29          void stop()   //åœæ­¢ SCLåœ¨é«˜ç”µå¹³æœŸé—´ï¼ŒSDAä¸€ä¸ªä¸Šå‡æ²¿åˆ™è¡¨ç¤ºåœæ­¢ä¿¡å·  
  30          {  
  31   1          sda=0;  
  32   1          delay();  
  33   1          scl=1;  
  34   1          delay();  
  35   1          sda=1;  
C51 COMPILER V9.56.0.0   LIBI2C                                                            08/03/2017 23:08:08 PAGE 2   

  36   1          delay();  
  37   1      }
  38          //***************************************************************************  
  39          void respons()  //åº”ç­” SCLåœ¨é«˜ç”µå¹³æœŸé—´ï¼ŒSDAè¢«ä»è®¾å¤‡æ‹‰ä¸ºä½ç”µå¹³è¡¨ç¤ºåº”ç­”  
  40          {  
  41   1          uchar i;  
  42   1          scl=1;  
  43   1          delay(); 
  44   1          //è‡³å¤šç­‰å¾…250ä¸ªCPUæ—¶é’Ÿå‘¨æœŸ 
  45   1          while((sda==1)&&(i<250))i++;  
  46   1          scl=0;  
  47   1          delay();  
  48   1      }  
  49          //***************************************************************************  
  50          void init()//æ€»çº¿åˆå§‹åŒ– å°†æ€»çº¿éƒ½æ‹‰é«˜ä¸€é‡Šæ”¾æ€»çº¿  å‘é€å¯åŠ¨ä¿¡å·å‰ï¼Œè¦å…ˆåˆå§‹åŒ–æ€»
             -çº¿ã€‚å³æ€»æœ‰æ£€æµ‹åˆ°æ€»çº¿ç©ºé—²æ‰å¼€å§‹å‘é€å¯åŠ¨ä¿¡å·  
  51          {  
  52   1          sda=1;  
  53   1          delay();  
  54   1          scl=1;  
  55   1          delay();  
  56   1      }  
  57          //***************************************************************************  
  58          void write_byte(uchar date) //å†™ä¸€ä¸ªå­—èŠ‚  
  59          {  
  60   1          uchar i,temp;  
  61   1          temp=date;  
  62   1        
  63   1        
  64   1          for(i=0;i<8;i++)  
  65   1          {  
  66   2              temp=temp<<1;  
  67   2              scl=0;//æ‹‰ä½SCLï¼Œå› ä¸ºåªæœ‰åœ¨æ—¶é’Ÿä¿¡å·ä¸ºä½ç”µå¹³æœŸé—´æŒ‰æ•°æ®çº¿ä¸Šçš„é«˜ä½ç”µå¹³çŠ¶
             -æ€æ‰å…è®¸å˜åŒ–ï¼›å¹¶åœ¨æ­¤æ—¶å’Œä¸Šä¸€ä¸ªå¾ªç¯çš„scl=1ä¸€èµ·å½¢æˆä¸€ä¸ªä¸Šå‡æ²¿  
  68   2              delay();  
  69   2              sda=CY;  
  70   2              delay();  
  71   2              scl=1;//æ‹‰é«˜SCLï¼Œæ­¤æ—¶SDAä¸Šçš„æ•°æ®ç¨³å®š  
  72   2              delay();  
  73   2          }  
  74   1          scl=0;//æ‹‰ä½SCLï¼Œä¸ºä¸‹æ¬¡æ•°æ®ä¼ è¾“åšå¥½å‡†å¤‡  
  75   1          delay();  
  76   1          sda=1;//é‡Šæ”¾SDAæ€»çº¿ï¼Œæ¥ä¸‹æ¥ç”±ä»è®¾å¤‡æ§åˆ¶ï¼Œæ¯”å¦‚ä»è®¾å¤‡æ¥æ”¶å®Œæ•°æ®åï¼Œåœ¨SCLä¸ºé
             -«˜æ—¶ï¼Œæ‹‰ä½SDAä½œä¸ºåº”ç­”ä¿¡å·  
  77   1          delay();  
  78   1      }  
  79          //***************************************************************************  
  80          uchar read_byte()//è¯»ä¸€ä¸ªå­—èŠ‚  
  81          {  
  82   1          uchar i,k;  
  83   1          scl=0;  
  84   1          delay();  
  85   1          sda=1;  
  86   1          delay();  
  87   1          for(i=0;i<8;i++)  
  88   1          {  
  89   2              scl=1;//ä¸Šå‡æ²¿æ—¶ï¼ŒIICè®¾å¤‡å°†æ•°æ®æ”¾åœ¨sdaçº¿ä¸Šï¼Œå¹¶åœ¨é«˜ç”µå¹³æœŸé—´æ•°æ®å·²ç»ç¨³å®š
             -ï¼Œå¯ä»¥æ¥æ”¶å•¦  
  90   2              delay();      
  91   2              k=(k<<1)|sda;  
  92   2              scl=0;//æ‹‰ä½SCLï¼Œä½¿å‘é€ç«¯å¯ä»¥æŠŠæ•°æ®æ”¾åœ¨SDAä¸Š  
  93   2              delay();      
C51 COMPILER V9.56.0.0   LIBI2C                                                            08/03/2017 23:08:08 PAGE 3   

  94   2          }  
  95   1          return k;  
  96   1      }  
  97          //***************************************************************************  
  98          void write_add(uchar address,uchar date)//ä»»æ„åœ°å€å†™ä¸€ä¸ªå­—èŠ‚  
  99          {  
 100   1          start();//å¯åŠ¨  
 101   1          write_byte(0xa0);//å‘é€ä»è®¾å¤‡åœ°å€  
 102   1          respons();//ç­‰å¾…ä»è®¾å¤‡çš„å“åº”  
 103   1          write_byte(address);//å‘å‡ºèŠ¯ç‰‡å†…åœ°å€  
 104   1          respons();//ç­‰å¾…ä»è®¾å¤‡çš„å“åº”  
 105   1          write_byte(date);//å‘é€æ•°æ®  
 106   1          respons();//ç­‰å¾…ä»è®¾å¤‡çš„å“åº”  
 107   1          stop();//åœæ­¢  
 108   1      }  
 109          //***************************************************************************  
 110          uchar read_add(uchar address)//è¯»å–ä¸€ä¸ªå­—èŠ‚  
 111          {  
 112   1          uchar date;  
 113   1          start();//å¯åŠ¨  
 114   1          write_byte(0xa0);//å‘é€å‘é€ä»è®¾å¤‡åœ°å€ å†™æ“ä½œ  
 115   1          respons();//ç­‰å¾…ä»è®¾å¤‡çš„å“åº”  
 116   1          write_byte(address);//å‘é€èŠ¯ç‰‡å†…åœ°å€  
 117   1          respons();//ç­‰å¾…ä»è®¾å¤‡çš„å“åº”  
 118   1          start();//å¯åŠ¨  
 119   1          write_byte(0xa1);//å‘é€å‘é€ä»è®¾å¤‡åœ°å€ è¯»æ“ä½œ  
 120   1          respons();//ç­‰å¾…ä»è®¾å¤‡çš„å“åº”  
 121   1          date=read_byte();//è·å–æ•°æ®  
 122   1          stop();//åœæ­¢  
 123   1          return date;//è¿”å›æ•°æ®  
 124   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  19 ERROR(S)
